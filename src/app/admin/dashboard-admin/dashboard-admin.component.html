<p>
  <mat-toolbar class="content">
    <div>
      <span class="content__name">Mes transactions</span>
    </div>

    <div class="filter">
      <mat-form-field appearance="outline" class="mat-select-content--1">
        <mat-label>Type de compte</mat-label>
        <mat-select (selectionChange)="onAccountTypeChange($event.value)">
          <mat-option selected value="">Aucun</mat-option>
          <mat-option value="current">Courant</mat-option>
          <mat-option value="savings">épargne</mat-option>
          <mat-option value="blocked">Bloqué</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field appearance="outline" class="mat-select-content--2">
        <mat-label>Statut</mat-label>
        <mat-select (selectionChange)="onStatusChange($event.value)">
          <mat-option selected value="">Aucun</mat-option>
          <mat-option value="in process">En cours de traitement</mat-option>
          <mat-option value="approved">Acceptée</mat-option>
          <mat-option value="rejected">Réjetée</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field appearance="outline" class="mat-select-content--3">
        <mat-label>Calendrier</mat-label>
        <input
          matInput
          [matDatepicker]="picker"
          (dateChange)="onDateChange($event)"
        />
        <mat-datepicker-toggle
          matIconSuffix
          [for]="picker"
        ></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline" class="mat-select-content--4">
        <mat-label>Rechercher par bénéficiaire ou par montant</mat-label>
        <input
          matInput
          #queryInput
          (keydown.enter)="onQueryChange(queryInput.value)"
        />
      </mat-form-field>
    </div>
  </mat-toolbar>
</p>

<div class="container-fluid mt-5">
  <div class="fluid">
    <table mat-table [dataSource]="(allTransactions$ | async) || []">
      <ng-container matColumnDef="accountIbanEmitter">
        <th mat-header-cell *matHeaderCellDef>Compte</th>
        <td mat-cell *matCellDef="let element">
          {{ element.accountIbanEmitter | slice : 0 : 11 }}*******
        </td>
      </ng-container>

      <ng-container matColumnDef="transactionType">
        <th mat-header-cell *matHeaderCellDef>Type de transaction</th>
        <td mat-cell *matCellDef="let element">
          {{ element.transactionType }}
        </td>
      </ng-container>

      <ng-container matColumnDef="amount">
        <th mat-header-cell *matHeaderCellDef>Montant</th>
        <td mat-cell *matCellDef="let element">{{ element.amount }} XOF</td>
      </ng-container>

      <ng-container matColumnDef="accountReceiver">
        <th mat-header-cell *matHeaderCellDef>Bénéficiaire</th>
        <td mat-cell *matCellDef="let element">
          {{ element.accountReceiver.name }}
        </td>
      </ng-container>

      <ng-container matColumnDef="createdAt">
        <th mat-header-cell *matHeaderCellDef>Date de création</th>
        <td mat-cell *matCellDef="let element">
          {{ element.createdAt | date : "dd/MM/y" }}
        </td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Statut</th>
        <td mat-cell *matCellDef="let element">
          <span [innerHTML]="element.status | Status"></span>
        </td>
      </ng-container>
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let element">
          <button
            *ngIf="element.status == 'in process'"
            mat-flat-button
            [matMenuTriggerFor]="menu"
          >
            <mat-icon matIconSuffix style="order: 1" class="ms-3"
              >expand_more</mat-icon
            >
          </button>
          <mat-menu #menu="matMenu" yPosition="below" xPosition="after">
            <button mat-menu-item (click)="validateTransaction(element.id)">
              Accepté
            </button>
            <button mat-menu-item (click)="rejectTransaction(element.id)">
              Rejeté
            </button>
          </mat-menu>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
    <mat-paginator
      [length]="10"
      [pageSize]="10"
      [pageSizeOptions]="[5, 10]"
      aria-label="Select page"
    >
    </mat-paginator>
  </div>

  <button class="logout-btn" (click)="logout()">
    <p class="logout-btn-text">Se déconnecter</p>
  </button>
</div>
